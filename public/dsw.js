var PWASettings={version:1.2,applyImmediately:!0,appShell:["/","/dsw.js","/index.html","/articles/","/artigos/","/home/","/about/","/sobre/","/utils/","/uteis/","/styles/main.min.css","/scripts/default.min.js","/sh/prism.min.css","/sh/prism.js","/images/relax.jpg","/images/icons.png","/images/felipe-moura-felipenmoura-square.jpg","/resources/vibe.js.png","/resources/lab-canvas-image-editor-gama.png","/resources/exp-test-your-might.png","/resources/lab-chroma-key-js.png","/resources/lab-tv-3d-stereoscopic-html.png","/resources/lab-3d-builder-tool-environment.png","/images/photos/photo-felipe-n-moura-chrome-summit-2016.jpg","/images/photos/photo-felipe-n-moura-chrome-summit-2016-thumb.jpg","/images/photos/photo-felipe-n-moura-google-sp-2016.jpg","/images/photos/photo-felipe-n-moura-google-sp-2016-thumb.jpg","/images/photos/photo-felipe-n-moura-braziljs-2015.jpg","/images/photos/photo-felipe-n-moura-braziljs-2015-thumb.jpg","/images/photos/photo-felipe-n-moura-braziljs-stage-2013.jpg","/images/photos/photo-felipe-n-moura-braziljs-stage-2013-thumb.jpg","/images/photos/photo-felipe-n-moura-fisl-2012-speaking-talk.jpg","/images/photos/photo-felipe-n-moura-fisl-2012-speaking-talk-thumb.jpg","/images/photos/photo-felipe-n-moura-stage-braziljs-2012.jpg","/images/photos/photo-felipe-n-moura-stage-braziljs-2012-thumb.jpg","/images/photos/photo-felipe-n-moura-stage-braziljs-2012-2-brendan-eich.jpg","/images/photos/photo-felipe-n-moura-stage-braziljs-2012-2-brendan-eich-thumb.jpg","/images/photos/photo-felipe-n-moura-stage-braziljs-2013-5.jpg","/images/photos/photo-felipe-n-moura-stage-braziljs-2013-5-thumb.jpg","/images/photos/photo-felipe-n-moura-stage-braziljs-2013-2.jpg","/images/photos/photo-felipe-n-moura-stage-braziljs-2013-2-thumb.jpg","/images/photos/photo-felipe-n-moura-stage-braziljs-2013-3.jpg","/images/photos/photo-felipe-n-moura-stage-braziljs-2013-3-thumb.jpg","/images/photos/photo-felipe-n-moura-stage-braziljs-2013-4.jpg","/images/photos/photo-felipe-n-moura-stage-braziljs-2013-4-thumb.jpg","/images/photos/photo-felipe-n-moura-stage-braziljs-2013-stage.jpg","/images/photos/photo-felipe-n-moura-stage-braziljs-2013-stage-thumb.jpg"],rules:{notFoundPages:{match:{extension:["html","htm"],status:[404,500]},apply:{fetch:"/404.html"}},notFoundImages:{match:{extension:["png","jpg","jpeg","webp","gif"],status:[404,500]},apply:{fetch:"/images/transparent.gif"}},cacheImages:{match:{extension:["png","jpg","jpeg","webp","gif"]},apply:{cache:{name:"cached-images",version:1}}},statics:{match:{extension:["js","css"]},apply:{cache:{name:"static-files",expires:"1w",version:1}}},cacheFiles:{match:{path:"/.*"},apply:{cache:{name:"cached-files",version:1,expires:"1w"}}}}};!function e(t,n,r){function a(o,s){if(!n[o]){if(!t[o]){var c="function"==typeof require&&require;if(!s&&c)return c(o,!0);if(i)return i(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return a(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)a(r[o]);return a}({1:[function(e,t,n){"use strict";function r(e,t){var n=void 0,r=Number.MAX_SAFE_INTEGER,a=void 0;return t.forEach(function(t){var i=new RegExp(t.rx),o=e.match(i);o&&o.length<r&&(n=t,r=o.length,a=o)}),!!n&&{rule:n,matching:a}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r},{}],2:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var a=r(e("./indexeddb-manager.js")),i=r(e("./utils.js")),o=r(e("./logger.js")),s="defaultDSWCached",c="cacheCreatedTime",u=null,l=void 0,d=void 0,f=void 0,h=function(e,t){var n=t||-1;if("string"==typeof n){var r={s:1,m:60,h:3600,d:86400,w:604800,M:2592e3,Y:31449600},a=n.slice(-1),i=n.slice(0,-1);r[a]?n=i*r[a]:(o.default.warn("Invalid duration "+n,e),n=-1)}return n>=0?1e3*parseInt(n,10):0},p={setup:function(e,t,n){l=e,f=n,u=(d=t).dswVersion||"1",a.default.setup(p),a.default.create({version:1,name:c,key:"url"})},registeredCaches:[],createDB:function(e){return a.default.create(e)},deleteUnusedCaches:function(e){if(!e)return caches.keys().then(function(e){return p.registeredCaches,Promise.all(e.map(function(e){if(p.registeredCaches.indexOf(e)<0)return caches.delete(e)}))})},clear:function(e){return"window"in self?window.DSW.sendMessage({clearEverythingUp:!0},!0):caches.keys().then(function(e){var t=e.map(function(e){return caches.delete(e)});return t.push(a.default.clear()),Promise.all(t)})},mountCacheId:function(e){if("string"==typeof e)return e;var t=!!e&&e.action.cache;return t?(t.name||s)+"::"+(t.version||u):s+"::"+u},register:function(e){p.registeredCaches.push(p.mountCacheId(e))},addAll:function(e){return new Promise(function(t,n){Array.isArray(e)&&(e={files:e});var r=[];e.files.map(function(t){r.push(p.add(t,null,null,{action:{fetch:t,cache:{name:e.name,version:e.version||1,expires:e.expires||!1}}}))}),Promise.all(r).then(t).catch(n)})},put:function(e,t,n){return p.add(t,"string"==typeof e?e:p.mountCacheId(e),n,e)},add:function(e,t,n,r){return t=t||p.mountCacheId(r),new Promise(function(a,s){function c(n){200==n.status||"opaque"==n.type?caches.open(t).then(function(s){var c="opaque"==n.type?{mode:"no-cors"}:{};0!==(e.url||e).indexOf("http")&&(e=i.default.fixURL(e.url||e)),"POST"!=(e=i.default.createRequest(e,c)).method&&function(){var a={};a=r&&r.action&&r.action.cache?r.action.cache:{name:t,version:t.split("::")[1]};var i=void 0;n.bodyUsed?s.add(e).then(function(t){l.traceStep(e,"Added to cache",{cacheData:a})}).catch(function(e){o.default.error("Could not save into cache",e)}):(i=n.clone(),l.traceStep(e,"Added to cache",{cacheData:a}),s.put(e,i))}(),a(n),r&&r.action&&r.action.cache&&r.action.cache.expires&&p.setExpiringTime(e,r||t,r.action.cache.expires)}).catch(function(e){o.default.error("Could not save into cache",e),a(n)}):s(n)}n?c(n):fetch(f(null,e)).then(c).catch(function(t){l.traceStep(e,"Fetch failed"),o.default.error("[ DSW ] :: Failed fetching "+(e.url||e),t),s(n)})})},setExpiringTime:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;"string"==typeof n&&(n=h(t,n)),a.default.addOrUpdate({url:e.url||e,dateAdded:(new Date).getTime(),expiresAt:n},c)},hasExpired:function(e){return new Promise(function(t,n){a.default.find(c,"url",e.url||e).then(function(e){t(e&&(new Date).getTime()>e.dateAdded+e.expiresAt?!0:!1)}).catch(function(e){t(!1)})})},get:function(e,t,n,r,s){var c=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],u=Object.keys(e.action)[0],d=t.url||t,h=new URL(d).pathname;!1===e.action.cache||"/"!=h&&!h.match(/^\/index\.([a-z0-9]+)/i)||(e.action.cache=e.action.cache||{});var g=e.options||{};g.headers=g.headers||new Headers,u=u.toLowerCase(),u="idb"==u?"indexeddb":u;var m=void 0,v=null;switch(m=e.action.cache&&e.action.cache.expires?p.hasExpired(t):Promise.resolve(),u){case"bypass":if("request"==e.action[u]){var S=function(e){return e.status>=200&&e.status<300?(l.traceStep(n.request,"Request bypassed"),e):(l.traceStep(n.request,"Bypassed request failed and was ignored"),new Response(""))};return fetch(f(null,n.request)).then(S).catch(S)}l.traceStep(n.request,"Bypassed request"),u="output",e.action[u]="";case"output":return l.traceStep(n.request,"Responding with string output",{output:(e.action[u]+"").substring(0,180)}),new Response(i.default.applyMatch(r,e.action[u]));case"indexeddb":return new Promise(function(i,o){function s(r){if(!r||200!=r.status)return d=t.url,h=new URL(d).pathname,l.traceStep(n.request,"Fetch failed",{url:t.url,status:r.status,statusText:r.statusText}),l.treatBadPage(r,h,n);var o=function(e){e?l.traceStep(n.request,"Could not save response into IndexedDB",{err:e}):l.traceStep(n.request,"Response object saved into IndexedDB"),i(r)};a.default.save(e.name,r.clone(),t,e).then(o).catch(o)}a.default.get(e.name,t).then(function(a){return a?(l.traceStep(n.request,"Found stored in IndexedDB"),s(a)):(l.traceStep(n.request,"Will fetch",{url:t.url,method:t.method}),f(e,t,n,r).then(s).catch(s))})});case"redirect":case"fetch":t=l.createRedirect(e.action.fetch||e.action.redirect,n,r),d=t.url,h=new URL(d).pathname;case"cache":return v=n.request.cachedFrom?n.request.cachedFrom:null,e.action.cache&&p.mountCacheId(e),m.then(function(a){var d=void 0;return a&&!s?(l.traceStep(n.request,"Cache was expired"),d=Promise.resolve()):d=caches.match(v||t),d.then(function(s){if(s&&200!=s.status)return l.traceStep(n.request,"Not found in cache",{url:t.url,status:s.status,statusText:s.statusText}),a?(l.traceStep(n.request,"Forcing "+(a?"expired ":"")+"from cache"),p.get(e,t,n,r,!0)):(c&&(l.rules[s.status]||[]).some(function(a,i){if(h.match(a.rx)&&(a.action.fetch||a.action.redirect))return l.traceStep(n.request,"Found fallback for failure",{rule:a,url:t.url}),s=f(e,t,n,r),!0}),s);if(s)return t.url==n.request.url?(l.traceStep(n.request,"Result found in cache",{url:n.request.url,cacheSource:n.request.cachedFrom||n.request.url}),s):(l.traceStep(n.request,"Redirecting",{from:n.request.url,to:t.url},!1,{url:t.url,id:t.requestId,steps:t.traceSteps,rule:e}),Response.redirect(t.url,302));if("redirect"==u)return l.traceStep(n.request,"Must redirect",{from:n.request.url,to:t.url},!1,{url:t.url,id:t.requestId,steps:t.traceSteps,rule:e}),Response.redirect(t.url,302);var d=function(s){return"opaque"==s.type?!1!==e.action.cache?(l.traceStep(n.request,"Added to cache (opaque)",{url:t.url}),p.add(i.default.createRequest(t,{mode:t.mode||"no-cors"}),p.mountCacheId(e),s,e)):s:(s.status||(s.status=404),200==s.status?(l.traceStep(n.request,"Received result OK (200)",{url:t.url}),!1!==e.action.cache?(l.traceStep(n.request,"Saving into cache",{url:t.url}),p.add(t,p.mountCacheId(e),s,e)):s):(l.traceStep(t,"Failed fetching",{url:t.url}),a?(o.default.warn("Cache for ",t.url||t,"had expired, but the updated version could not be retrieved from the network!\n","Delivering the outdated cached data"),l.traceStep(n.request,"Using expired cache",{note:"Failed fetching, loading from cache even though it was expired"}),p.get(e,t,n,r,!0)):l.treatBadPage(s,h,n)))};return c?(l.traceStep(n.request,"Will fetch",{url:t.url,method:t.method}),f(e,t,n,r).then(d).catch(d)):void 0})});default:return n}}};n.default=p},{"./indexeddb-manager.js":4,"./logger.js":5,"./utils.js":8}],3:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=t.mode;a&&"navigate"!=a||(a=r?"cors":"no-cors");var i=new Request(e,{method:t.method||"GET",headers:t.headers||{},mode:a,cache:"default",redirect:"manual"});return t.body&&(i.body=t.body),i.requestId=(n?n.request:t).requestId,i.traceSteps=(n?n.request:t).traceSteps,i}function i(e,t,n,r){var i=e?e.action.fetch||e.action.redirect:"";"string"==typeof t&&(t=o.default.fixURL(t),t=location.origin+t),i?(i=o.default.fixURL(i),i=location.origin+i):i=t.url||t;var c=void 0;try{c=new URL(i).origin==s}catch(e){throw new Error('The URL "'+i+'" is not valid and could not be parsed.')}if(i=o.default.applyMatch(r,i),t&&!e)return a(i,t,n,c);var u=Object.keys(e.action)[0],l=e.options||{};l.headers=l.headers||new Headers,!1===e.action.cache&&(l.headers.append("pragma","no-cache"),l.headers.append("cache-control","no-store,no-cache"),i=i+(i.indexOf("?")>0?"&":"?")+(new Date).getTime());var d={method:l.method||t.method,headers:l||t.headers,mode:"redirect"==u?t.mode||"same-origin":"cors",redirect:"redirect"==u?"manual":t.redirect};return c||(d.mode=t.mode||"no-cors"),t=new Request(i||t.url,d),t.requestId=(n?n.request:t).requestId,t.traceSteps=(n?n.request:t).traceSteps,"redirect"==u?Response.redirect(t.url,302):fetch(t,l)}Object.defineProperty(n,"__esModule",{value:!0});var o=r(e("./utils.js")),s=location.origin;n.default=i},{"./utils.js":8}],4:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"readwrite",n=u[e];return!!n&&n.transaction(e,t).objectStore(e)}Object.defineProperty(n,"__esModule",{value:!0});var i,o=r(e("./logger.js")),s="defaultDSWDB",c="indexeddb-id-request",u={},l={setup:function(e){i=e},clear:function(){var e=[],t=function(t){e.push(new Promise(function(e,n){var r=indexedDB.deleteDatabase(t);r.onsuccess=function(){e()},r.onerror=function(e){n(),o.default.error("Could not drop indexedDB database\n",e||this.error)},r.onblocked=function(e){n(),o.default.error("Could not drop indexedDB database, it was locked\n",e||this.error)}}))};for(var n in u)t(n);return Promise.all([].concat(e))},create:function(e){return new Promise(function(t,n){function r(t,n,r){t.onversionchange=function(e){t.close()},u[n]||(u[n]=t),r(e)}var a=indexedDB.open(e.name||s,parseInt(e.version,10)||void 0);a.onerror=function(t){n("Could not open the database (indexedDB) for "+e.name)},a.onupgradeneeded=function(n){var a=n.target.result,i={};e.key&&(i.keyPath=e.key),e.key&&!e.autoIncrement||(i.autoIncrement=!0),e.version?i.version=e.version:i.version=1,n.oldVersion&&n.oldVersion<i.version?a.deleteObjectStore(e.name):0===n.oldVersion&&function(){var t=a.createObjectStore(e.name,i);e.indexes&&e.indexes.forEach(function(e){"string"==typeof e?t.createIndex(e,e,{}):t.createIndex(e.name,e.path||e.name,e.options)}),t.createIndex(e.key,e.key,{unique:!0})}(),r(a,e.name,t)},a.onsuccess=function(n){r(n.target.result,e.name,t)}})},get:function(e,t){return new Promise(function(n,r){caches.match(t).then(function(t){t?t.json().then(function(t){var r=a(e),i=!!r&&r.index(t.key),o=!!i&&i.get(t.value);o?(o.onsuccess=function(e){n(new Response(JSON.stringify(e.target.result),{headers:{"Content-Type":"application/json"}}))},o.onerror=function(e){n()}):n()}):n()})})},find:function(e,t,n){return new Promise(function(r,i){var o=a(e);if(o){var s=o.index(t).get(n);s.onsuccess=function(e){r(e.target.result)},s.onerror=function(e){i()}}else r()})},addOrUpdate:function(e,t){return new Promise(function(n,r){var i=a(t);if(i){var o=i.put(e);o.onsuccess=function(){n(e)},o.onerror=function(t){n(e)}}else n({})})},save:function(e,t,n,r){var s=this;return new Promise(function(u,l){t.json().then(function(t){var o=a(e),d=void 0;o?((d=o.put(t)).onsuccess=function(){var e={},a=r.action.indexedDB.key||"id";e.key=a,e.value=t[a],i.put(c,n,new Response(JSON.stringify(e),{headers:{"Content-Type":"application/json"}})),u()},d.onerror=function(e){l("Failed saving to the indexedDB!\n"+this.error)}):l("Failed saving into indexedDB...\n"+s.error)}).catch(function(e){o.default.error("Failed saving into indexedDB!\n",e.message||s.error,e),l("Failed saving into indexedDB:\n"+s.error)})})}};n.default=l},{"./logger.js":5}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={log:"[  LG  ] :: ",info:"[ INFO ] :: ",warn:"[ WARN ] :: ",error:"[ FAIL ] :: ",track:"[ STEP ] :: "},a={info:function(){var e=[].slice.call(arguments);e.unshift("color: blue"),e.unshift("%c "+r.info),console.info.apply(console,e)},log:function(){var e=[].slice.call(arguments);e.unshift("color: gray"),e.unshift("%c "+r.log),console.log.apply(console,e)},warn:function(){var e=[].slice.call(arguments);e.unshift("font-weight: bold; color: yellow; text-shadow: 0 0 1px black;"),e.unshift("%c "+r.warn),console.warn.apply(console,e)},error:function(){var e=[].slice.call(arguments);e.unshift("font-weight: bold; color: red"),e.unshift("%c "+r.error),console.error.apply(console,e)},track:function(){var e=[].slice.call(arguments);e.unshift("font-weight: bold"),e.unshift("%c "+r.track),console.debug.apply(console,e)}};n.default=a},{}],6:[function(e,t,n){(function(t){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(){return p||(p=new URL(location.href).pathname.replace(/\/[^\/]+$/,"/"))}Object.defineProperty(n,"__esModule",{value:!0});var i,o=r(e("./logger.js")),s=r(e("./best-matching-rx.js")),c=r(e("./cache-manager.js")),u=r(e("./go-fetch.js")),l=r(e("./strategies.js")),d=r(e("./utils.js")),f=!1,h=(t.it,[]),p=null,g={version:"1.12.2",build:"1508745970865",ready:null},m=12e3,v={},S=function(e){return"Failed storing appshell.\n "+h.join(",")+" failed loading.\n"};g.isOffline=g.offline=function(e){return!navigator.onLine},g.isOnline=g.online=function(e){return navigator.onLine};try{ServiceWorkerGlobalScope;self instanceof ServiceWorkerGlobalScope&&(f=!0)}catch(e){}f?function(){var e={requestId:0,tracking:{},trackMoved:{},rules:{},addRule:function(e,t,n){this.rules[e]=this.rules[e]||[];var r={name:t.name,rx:n,strategy:t.strategy||"offline-first",action:t.apply};return this.rules[e].push(r),r.action.cache?c.default.register(r):!1===r.action.cache&&(r.strategy="online-first"),r},treatBadPage:function(t,n,r){var a=void 0;return e.traceStep(r.request,"Request failed",{status:t.status,statusText:t.statusText,url:t.url,type:t.type}),(e.rules[t&&t.status?t.status:404]||[]).some(function(t,i){var o=n.match(t.rx);if(o&&(t.action.redirect&&!t.action.fetch&&(t.action.fetch=t.action.redirect),t.action.fetch)){e.traceStep(r.request,"Found fallback rule",t,!1,{url:r.request.url,id:r.request.requestId,steps:r.request.traceSteps});var s=new Request(t.action.fetch);return s.requestId=r.request.requestId,s.traceSteps=r.request.traceSteps,a=c.default.get(t,s,r,o),!0}}),a||e.traceStep(r.request,"No fallback found. Request failed"),a||t},setup:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.rootSWScope=a(),d.default.setup(e,PWASettings,g),c.default.setup(e,PWASettings,u.default),l.default.setup(e,c.default,u.default),g.ready=new Promise(function(e,r){i=PWASettings.appShell||[];var s=[];Object.keys(n.rules||n.dswRules).forEach(function(e){var r=e;(e=(n.rules||n.dswRules)[e]).name=r,e.action=e.action||e.apply;var a=e.action,o=void 0,c=void 0,u=void 0;if((e.match.length||Object.keys(e.match).length)&&Object.keys(e.match).length){Array.isArray(e.match)?(o=[],u=[],e.match.map(function(e){e.extension&&o.push(e.extension),e.path&&u.push(e.path)}),(o=o.join("|")).length&&(o+="|"),u=(u.join("|")||"")+"|"):(u=e.match.path||"",o=e.match.extension,c=e.match.status);var l="([/&?]|$)";o=Array.isArray(o)?"([.+]?)("+o.join(l+"|")+l+")":"string"==typeof o?"([.+]?)("+o+l+")":"";var d=new RegExp(u+(o?"((\\.)(("+o+")([\\?&/].+)?))":""),"i"),f=/\$[0-9]+/;(a.fetch&&!a.fetch.match(f)||a.redirect&&!a.redirect.match(f)||a.cache&&a.cache.from)&&i.push({url:a.cache&&a.cache.from?a.cache.from:a.fetch||a.redirect,rule:e}),a.indexedDB=a.indexedDB||a.idb||a.IDB||void 0,a.indexedDB&&s.push(a.indexedDB),(c=Array.isArray(c)?c:[c||"*"]).forEach(function(n){200==n&&(n="*");t.addRule(n,e,d)})}}),t.addRule("*",{name:"serviceWorker",strategy:"fastest",match:{path:/^\/dsw.js(\?=dsw-manager)?$/},apply:{cache:{}}},location.href);var u=/^(\/|\/index(\.[0-1a-z]+)?)$/;if(t.addRule("*",{name:"rootDir",strategy:"fastest",match:{path:a()},apply:{cache:{}}},u),i.unshift(a()),i.length||s.length)return Promise.all(i.map(function(e){var t=e.url||e;return c.default.add(t,null,null,e.rule).catch(function(e){if(e&&404==e.status)throw h.push(e.url),new Error(S())})}).concat(s.map(function(e){return c.default.createDB(e).catch(function(e){throw new Error("Failed preparing IndexedDB\n",e.message||e)})}))).then(function(t){e()}).catch(function(e){var t="Could not register the service worker.\n"+(e.url||e.message)+"\n";o.default.error(t,e),r(t)});e()})},getRulesBeforeFetching:function(){return this.rules["*"]||!1},createRequest:function(e,t,n){return(0,u.default)(null,e,t,n)},createRedirect:function(e,t,n){return(0,u.default)(null,e,t,n)},traceStep:function(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(Array.isArray(t))t.forEach(function(t){e.traceStep(t,n,r,a,i)});else{if(e.tracking){t.requestId;t.traceSteps=t.traceSteps||[],r=r||{},a&&(r.url=t.url,r.type=t.type,r.method=t.method,r.redirect=t.redirect,r.referrer=t.referrer);var o=(performance.now()-t.timeArriving)/1e3;t.traceSteps.push({step:n,data:r,timing:o.toFixed(4)+"s"})}i&&(e.trackMoved[i.url]=i)}},respondItWith:function(t,n){t.respondWith(new Promise(function(r,a){"function"==typeof n.then?n.then(function(n){if("function"!=typeof n.clone)return r(n);var a=n.clone();e.tracking&&302!=a.status&&a.text().then(function(n){(n[0]||"").charCodeAt(0)<128&&(n=n.substring(0,180)+(n.length>180?"...":"")),e.traceStep(t.request,"Responded",{response:{status:a.status,statusText:a.statusText,type:a.type,method:a.method,url:a.url},preview:n},!0),e.sendTraceData(t)}),r(n)}):r(n)}))},sendTraceData:function(t){var n=void 0,r=function(e,n){var r={id:t.request.requestId,src:t.request.traceSteps[0].data.url,method:t.request.traceSteps[0].data.method,steps:t.request.traceSteps};r.src!=t.request.url&&(r.redirectedTo=t.request.url),e.postMessage(r)};for(n in e.tracking)if(t.request.url.match(n)){e.tracking[n].ports.forEach(r);break}t.request.traceSteps&&t.request.traceSteps.length&&delete e.trackMoved[t.request.traceSteps[0].data.url]},broadcast:function(e){return clients.matchAll().then(function(t){t.forEach(function(t){t.postMessage(e)})})},startListening:function(){self.addEventListener("fetch",function(t){if(e.requestId=1+(e.requestId||0),e.trackMoved[t.request.url]){var n=e.trackMoved[t.request.url];t.request.requestId=n.id,t.request.traceSteps=n.steps,t.request.originalSrc=n.url,n.rule&&n.rule.action&&n.rule.action.cache&&n.rule.action.cache.from&&(t.request.cachedFrom=n.rule.action.cache.from),delete e.trackMoved[t.request.url]}else t.request.requestId=e.requestId,t.request.timeArriving=performance.now(),e.traceStep(t.request,"Arrived in Service Worker",{},!0);var r=new URL(t.request.url),a=r.origin==location.origin,i=r.pathname;if("GET"!=t.request.method)return e.traceStep(t.request,"Ignoring "+t.request.method+" request",{}),void e.sendTraceData(t);if(!Object.keys(e.rules).length)return e.setup(PWASettings).then(function(e){return fetch(t)});if(PWASettings.enforceSSL&&"https:"!=r.protocol&&"localhost"!=r.hostname)return e.traceStep(t.request,"Redirected from http to https"),e.respondItWith(t,Response.redirect(t.request.url.replace("http:","https:"),302));var o=void 0;if(o=a?(0,s.default)(i,e.rules["*"]):(0,s.default)(r.origin+r.pathname,e.rules["*"]))return e.traceStep(t.request,'Best matching rule found: "'+o.rule.name+'"',{rule:o.rule,url:t.request.url}),e.respondItWith(t,l.default[o.rule.strategy](o.rule,t.request,t,o.matching));if(!a)return e.traceStep(t.request,"Ignoring request because it is not from same origin and there are no rules for it",{}),void e.sendTraceData(t);var c=function(n){return!n||200!=n.status&&"opaque"!=n.type&&"opaqueredirect"!=n.type?e.treatBadPage(n,i,t):n};return e.respondItWith(t,fetch((0,u.default)(null,t.request)).then(c).catch(c))})}},t=!1,n=null;self.addEventListener("activate",function(r){r.waitUntil(function(r){var a=[];return PWASettings.applyImmediately&&a.push(self.clients.claim()),a.push(c.default.deleteUnusedCaches(PWASettings.keepUnusedCaches)),Promise.all(a).then(function(r){e.broadcast({DSWStatus:t,error:n||null})}).catch(function(r){e.broadcast({DSWStatus:t,error:r||n})})}())}),self.addEventListener("install",function(r){return PWASettings.dswRules=PWASettings.rules||PWASettings.dswRules||{},PWASettings.dswVersion=PWASettings.version||PWASettings.dswVersion||"1",PWASettings.applyImmediately?r.waitUntil(e.setup(PWASettings).then(function(e){t=!0,self.skipWaiting()}).catch(function(e){t=!1,n=e,self.skipWaiting()})):r.waitUntil(e.setup(PWASettings))}),self.addEventListener("message",function(t){var n=t.ports;if(t.data.trackPath){var r=t.data.trackPath;e.tracking[r]={rx:new RegExp(r,"i"),ports:n}}else if(t.data.clearEverythingUp)c.default.clear().then(function(e){n.forEach(function(e){e.postMessage({cacheCleaned:!0})})});else if(t.data.enableMocking){var a=t.data.enableMocking.mockId+t.data.enableMocking.match;v[t.source.id]=v[t.source.id]||{};var i=v[t.source.id];return i[a]=i[a]||[],void v[a].push()}}),self.addEventListener("push",function(t){if(e.broadcast({event:"pushnotification",data:t.data}),PWASettings.notification&&PWASettings.notification.dataSrc)return t.waitUntil(fetch(PWASettings.notification.dataSrc).then(function(e){if(200==e.status)return e.json().then(function(e){var t={};t=PWASettings.notification.dataPath?e[PWASettings.notification.dataPath]:e;self.registration.showNotification(t.title,{body:t.body||t.content||t.message,icon:t.icon||t.image,tag:t.tag||null})});throw new Error("Fetching "+PWASettings.notification.dataSrc+" returned a "+e.status+" status.")}).catch(function(e){o.default.warn("Received a push, but Failed retrieving the notification data.",e)}));if(PWASettings.notification.title){var n=PWASettings.notification;self.registration.showNotification(n.title,{body:n.body||n.content||n.message,icon:n.icon||n.image,tag:n.tag||null})}}),self.addEventListener("notificationclick",function(t){var n=void 0,r={tag:t.notification.tag,title:t.notification.title,body:t.notification.body,icon:t.notification.icon,badge:t.notification.badge,lang:t.notification.lang,timestamp:t.notification.timestamp};t.notification.close(),n=PWASettings.notification&&void 0!==PWASettings.notification.target?PWASettings.notification.target:location.toString(),t.waitUntil(clients.matchAll({type:"window"}).then(function(t){for(var a=void 0,i=0;i<t.length;i++){var o=t[i];if((o.url==n||new URL(o.url).pathname==n)&&"focus"in o){a=o.focus();break}}(a=!a&&n&&clients.openWindow?clients.openWindow(n):Promise.resolve()).then(function(t){e.broadcast({event:"notificationclicked",data:r})})}))}),self.addEventListener("sync",function(e){}),e.startListening()}():function(){g.status={version:PWASettings.version||PWASettings.dswVersion,registered:!1,sync:!1,appShell:!1,notification:!1};var e=void 0,t=void 0,n=void 0,r=void 0,a=function(){var e={};return{addEventListener:function(t,n){e[t]=e[t]||[],e[t].push(n)},trigger:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=void 0;try{if(e[t]){var a=!0,i=!1,s=void 0;try{for(var c,u=e[t][Symbol.iterator]();!(a=(c=u.next()).done);a=!0)"function"==typeof(r=c.value)&&r(n)}catch(e){i=!0,s=e}finally{try{!a&&u.return&&u.return()}finally{if(i)throw s}}}"function"==typeof g[r="on"+t]&&g[r](n)}catch(e){r=r&&r.name?r.name:r||"annonymous",o.default.error("Failed trigerring event "+t+" on listener "+r,e.message,e)}}}}();g.addEventListener=a.addEventListener,g.onpushnotification=function(){},g.onnotificationclicked=function(){},g.onenabled=function(){},g.onregistered=function(){},g.onunregistered=function(){},g.onnotificationsenabled=function(){},navigator.serviceWorker.addEventListener("message",function(r){e&&void 0!==r.data.DSWStatus&&(n&&(r.data.DSWStatus?(g.status.appShell=!0,a.trigger("activated",g.status),e(g.status)):(g.status.appShell=!1,g.status.error=r.data.error,t(g.status),n.unregister())),e=!1,t=!1),a.trigger(r.data.event,r.data.data)}),g.trace=function(e,t,n){n||"function"!=typeof t||(n=t,t={});var r=new MessageChannel;r.port1.onmessage=function(e){n(e.data)},navigator.serviceWorker.controller.postMessage({trackPath:e},[r.port2])},g.enableMocking=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".*",n=new MessageChannel;navigator.serviceWorker.controller.postMessage({enableMocking:{mockId:e,match:t}},[n.port2])},g.disableMocking=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".*",n=new MessageChannel;navigator.serviceWorker.controller.postMessage({disableMocking:{mockId:e,match:t}},[n.port2])},g.sendMessage=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(function(n,r){var a=new MessageChannel;t?a.port1.onmessage=function(e){e.data.error?r(e.data.error):n(e.data)}:setTimeout(n,10),navigator.serviceWorker.controller.postMessage(e,[a.port2])})},g.onNetworkStatusChange=function(e){var t=function(){e(navigator.onLine)};window.addEventListener("online",t),window.addEventListener("offline",t),navigator.onLine||t()},g.isAppShellDone=g.isActivated=function(e){return g.status.registered&&g.status.appShell},g.isRegistered=function(e){return g.status.registered},g.enableNotifications=function(e){return new Promise(function(e,t){navigator.onLine?navigator.serviceWorker.ready.then(function(n){return n.pushManager.subscribe({userVisibleOnly:!0}).then(function(t){g.status.notification=t.endpoint,a.trigger("notificationsenabled",g.status),o.default.info("Registered to notification server"),e(t)}).catch(function(e){t(e||"Not allowed by user")})}):t("Must be connected to enable notifications")})},g.notify=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Untitled",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(n,r){g.enableNotifications().then(function(r){var a={body:t.body||"",icon:t.icon||!1,tag:t.tag||null},i=new Notification(e,a);t.duration&&setTimeout(function(e){i.close()},1e3*t.duration),n(i)}).catch(function(e){r(e)})})},g.unregister=function(e){return new Promise(function(e,t){g.status&&(g.status.registered||e(g.status)),g.ready.then(function(r){c.default.clear().then(function(r){r?(g.status.appShell=!1,localStorage.setItem("DSW-STATUS",JSON.stringify(g.status)),n.unregister().then(function(n){n?(g.status.registered=!1,g.status.sync=!1,g.status.notification=!1,g.status.ready=!1,localStorage.setItem("DSW-STATUS",JSON.stringify(g.status)),e(g.status),a.trigger("unregistered",g.status)):t("Could not unregister service worker")})):t("Could not clean up the caches")})})})},g.setup=function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return g.ready?g.ready:new Promise(function(s,c){if(g.ready=new Promise(function(s,c){var u=new Promise(function(t,n){e=function(){clearTimeout(r),t(g.status)}});if(t=function(e){clearTimeout(r),c(e||"Installation timeout")},navigator.serviceWorker)if(navigator.serviceWorker.controller)i&&i.trace?navigator.serviceWorker.ready.then(function(e){n=e;var t=void 0;for(t in i.trace)g.trace(t,i.trace[t])}):navigator.serviceWorker.ready.then(function(e){n=e}),g.status=JSON.parse(localStorage.getItem("DSW-STATUS"))||g.status,s(g.status);else{r=setTimeout(function(e){c("Registration timed out")},i.timeout||m);var l=new Promise(function(e){"complete"===document.readyState?e(document):document.addEventListener("DOMContentLoaded",function(){e(document)})}),d=document.querySelector('script[src$="dsw.js"]').getAttribute("src");Promise.all([l,navigator.serviceWorker.register(d)]).then(function(e){n=e,g.status.registered=!0,navigator.serviceWorker.ready.then(function(e){g.status.ready=!0,a.trigger("registered",g.status),Promise.all([u,new Promise(function(e,t){if(PWASettings.notification&&PWASettings.notification.auto)return g.enableNotifications();e()}),new Promise(function(e,t){i&&i.sync?"SyncManager"in window?navigator.serviceWorker.ready.then(function(e){return e.sync.register("syncr")}).then(function(t){g.status.sync=!0,e()}):(g.status.sync="Failed enabling sync",e()):e()})]).then(function(e){localStorage.setItem("DSW-STATUS",JSON.stringify(g.status)),a.trigger("enabled",g.status),o.default.info("Service Worker was registered",g.status),s(g.status)})})}).catch(function(e){c({status:!1,sync:!1,sw:!1,message:"Failed registering service worker with the message:\n "+e.message,error:e})})}else g.status.fail="Service worker not supported"}),!g.isActivated())return g.ready.then(function(e){s(e)}).catch(function(e){c(e)})})},"undefined"!=typeof window&&(window.DSW=g)}(),n.default=g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./best-matching-rx.js":1,"./cache-manager.js":2,"./go-fetch.js":3,"./logger.js":5,"./strategies.js":7,"./utils.js":8}],7:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t,n,r){e.action.bundle&&(o.traceStep(n.request,"Will load and cache bundle in background",{bundle:e.action.bundle}),s.addAll(e.action.bundle).then(function(t){o.traceStep(n.request,"Bundle loaded and cached in background",{bundle:e.action.bundle})}).catch(function(t){o.traceStep(n.request,"Could not load and cache bundle",{bundle:e.action.bundle}),console.warn("Could not load and cache all the bundle files",t.message||t)}))}Object.defineProperty(n,"__esModule",{value:!0});var i=r(e("./utils.js")),o=void 0,s=void 0,c=void 0,u={setup:function(e,t,n){o=e,s=t,c=n},"offline-first":function(e,t,n,r){return a(e,t,n,r),o.traceStep(n.request,"Info: Using offline first strategy",{url:t.url}),s.get(e,t,n,r)},"online-first":function(e,t,n,r){function u(a){return 200==a.status?(e.action.cache&&s.put(e,t,a).then(function(e){o.traceStep(n.request,"Updated cache")}),a):s.get(e,t,n,r).then(function(e){var t=new URL(n.request.url).pathname;return e||o.treatBadPage(a,t,n)})}return a(e,t,n,r),o.traceStep(n.request,"Info: Using online first strategy",{url:t.url}),i.default.DSW.isOffline()?u(new Response("",{status:404,statusText:"Browser is offline",headers:{"Content-Type":"text/plain"}})):c(e,t,n,r).then(u).catch(u)},fastest:function(e,t,n,r){a(e,t,n,r),o.traceStep(n.request,"Info: Using fastest strategy",{url:t.url});var i=new URL(n.request.url).pathname,u=!1,l=!1,d=!1,f=!1;return new Promise(function(a,h){function p(r){r&&200==r.status&&e.action.cache&&s.put(e,t,r).then(function(e){o.traceStep(n.request,"Updated cache")}),l||(200==r.status?(u=!0,o.traceStep(n.request,"Fastest strategy resolved from network",{url:r.url||t.url}),a(r)):(o.traceStep(n.request,"Fastest strategy failed fetching",{status:r.status,statusText:r.statusText}),d=!0,m(r)))}function g(e){if(e&&!u)return l=!0,o.traceStep(n.request,"Fastest strategy resolved from cached"),a(e),e;f=!0,u||m()}function m(e){d&&f&&(o.traceStep(n.request,"Fastest strategy could not fetch nor find in cache"),a(o.treatBadPage(e,i,n)))}c(e,t.clone(),n,r).then(p).catch(p),s.get(e,t,n,r,!1,!1).then(g).catch(m)})}};n.default=u},{"./utils.js":8}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={DSWManager:null,PWASettings:null,applyMatch:function(e,t){return e&&e.length>1&&t&&e.forEach(function(e,n){t=t.replace(new RegExp("\\$"+n,"i"),e)}),t},createRequest:function(e,t){var n={method:t.method||e.method||"GET",headers:t.headers||e.headers||new Headers,mode:t.mode||(t.redirect?"same-origin":"cors"),redirect:t.redirect||"manual",cache:"default"},r=new Request(e.url||e,n);return r.requestId=e.requestId,r},fixURL:function(e){return r.DSWManager.rootSWScope!=e?e.replace(/^([^http]|[^\/]|[^\.])/,r.DSWManager.rootSWScope+"/$1").replace(/([^\:])\/\//g,"$1"):e},setup:function(e,t,n){r.DSWManager=e,r.PWASettings=t,r.DSW=n}};n.default=r},{}]},{},[6]);