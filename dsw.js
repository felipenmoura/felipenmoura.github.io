const PWASettings={version:1.2,applyImmediately:true,appShell:["/","/dsw.js","/index.html","/articles/","/artigos/","/home/","/about/","/sobre/","/utils/","/uteis/","/styles/main.min.css","/scripts/default.min.js","/sh/prism.min.css","/sh/prism.js","/images/relax.jpg","/images/icons.png","/images/felipe-moura-felipenmoura-square.jpg","/resources/vibe.js.png","/resources/lab-canvas-image-editor-gama.png","/resources/exp-test-your-might.png","/resources/lab-chroma-key-js.png","/resources/lab-tv-3d-stereoscopic-html.png","/resources/lab-3d-builder-tool-environment.png","/images/photos/photo-felipe-n-moura-chrome-summit-2016.jpg","/images/photos/photo-felipe-n-moura-chrome-summit-2016-thumb.jpg","/images/photos/photo-felipe-n-moura-google-sp-2016.jpg","/images/photos/photo-felipe-n-moura-google-sp-2016-thumb.jpg","/images/photos/photo-felipe-n-moura-braziljs-2015.jpg","/images/photos/photo-felipe-n-moura-braziljs-2015-thumb.jpg","/images/photos/photo-felipe-n-moura-braziljs-stage-2013.jpg","/images/photos/photo-felipe-n-moura-braziljs-stage-2013-thumb.jpg","/images/photos/photo-felipe-n-moura-fisl-2012-speaking-talk.jpg","/images/photos/photo-felipe-n-moura-fisl-2012-speaking-talk-thumb.jpg","/images/photos/photo-felipe-n-moura-stage-braziljs-2012.jpg","/images/photos/photo-felipe-n-moura-stage-braziljs-2012-thumb.jpg","/images/photos/photo-felipe-n-moura-stage-braziljs-2012-2-brendan-eich.jpg","/images/photos/photo-felipe-n-moura-stage-braziljs-2012-2-brendan-eich-thumb.jpg","/images/photos/photo-felipe-n-moura-stage-braziljs-2013-5.jpg","/images/photos/photo-felipe-n-moura-stage-braziljs-2013-5-thumb.jpg","/images/photos/photo-felipe-n-moura-stage-braziljs-2013-2.jpg","/images/photos/photo-felipe-n-moura-stage-braziljs-2013-2-thumb.jpg","/images/photos/photo-felipe-n-moura-stage-braziljs-2013-3.jpg","/images/photos/photo-felipe-n-moura-stage-braziljs-2013-3-thumb.jpg","/images/photos/photo-felipe-n-moura-stage-braziljs-2013-4.jpg","/images/photos/photo-felipe-n-moura-stage-braziljs-2013-4-thumb.jpg","/images/photos/photo-felipe-n-moura-stage-braziljs-2013-stage.jpg","/images/photos/photo-felipe-n-moura-stage-braziljs-2013-stage-thumb.jpg"],rules:{notFoundPages:{match:{extension:["html","htm"],status:[404,500]},apply:{fetch:"/404.html"}},notFoundImages:{match:{extension:["png","jpg","jpeg","webp","gif"],status:[404,500]},apply:{fetch:"/images/transparent.gif"}},cacheImages:{match:{extension:["png","jpg","jpeg","webp","gif"]},apply:{cache:{name:"cached-images",version:1}}},statics:{match:{extension:["js","css"]},apply:{cache:{name:"static-files",expires:"1w",version:1}}},cacheFiles:{match:{path:"/.*"},apply:{cache:{name:"cached-files",version:1,expires:"1w"}}}}};(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function getBestMatchingRX(str,expressions){var bestMatchingRX=void 0;var bestMatchingGroupSize=Number.MAX_SAFE_INTEGER;var bestMatchingGroup=void 0;expressions.forEach(function(currentRX){var regex=new RegExp(currentRX.rx);var groups=str.match(regex);if(groups&&groups.length<bestMatchingGroupSize){bestMatchingRX=currentRX;bestMatchingGroupSize=groups.length;bestMatchingGroup=groups}});return bestMatchingRX?{rule:bestMatchingRX,matching:bestMatchingGroup}:false}exports.default=getBestMatchingRX},{}],2:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _indexeddbManager=require("./indexeddb-manager.js");var _indexeddbManager2=_interopRequireDefault(_indexeddbManager);var _utils=require("./utils.js");var _utils2=_interopRequireDefault(_utils);var _logger=require("./logger.js");var _logger2=_interopRequireDefault(_logger);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var DEFAULT_CACHE_NAME="defaultDSWCached";var CACHE_CREATED_DBNAME="cacheCreatedTime";var DEFAULT_CACHE_VERSION=null;var DSWManager=void 0,PWASettings=void 0,goFetch=void 0;function lengthInUtf8Bytes(str){var m=encodeURIComponent(str).match(/%[89ABab]/g);return str.length+(m?m.length:0)}var parseExpiration=function parseExpiration(rule,expires){var duration=expires||-1;if(typeof duration=="string"){var sizes={s:1,m:60,h:3600,d:86400,w:604800,M:2592e3,Y:31449600};var size=duration.slice(-1),val=duration.slice(0,-1);if(sizes[size]){duration=val*sizes[size]}else{_logger2.default.warn("Invalid duration "+duration,rule);duration=-1}}if(duration>=0){return parseInt(duration,10)*1e3}else{return 0}};var cacheManager={setup:function setup(DSWMan,PWASet,ftch){PWASettings=PWASet;DSWManager=DSWMan;goFetch=ftch;DEFAULT_CACHE_VERSION=PWASettings.dswVersion||"1";_indexeddbManager2.default.setup(cacheManager);_indexeddbManager2.default.create({version:1,name:CACHE_CREATED_DBNAME,key:"url"})},registeredCaches:[],createDB:function createDB(db){return _indexeddbManager2.default.create(db)},deleteUnusedCaches:function deleteUnusedCaches(keepUnused){if(!keepUnused){return caches.keys().then(function(keys){cacheManager.registeredCaches;return Promise.all(keys.map(function(key){if(cacheManager.registeredCaches.indexOf(key)<0){return caches.delete(key)}}))})}},clear:function clear(_){if("window"in self){return window.DSW.sendMessage({clearEverythingUp:true},true)}else{return caches.keys().then(function(keys){var cleanItUp=keys.map(function(key){return caches.delete(key)});cleanItUp.push(_indexeddbManager2.default.clear());return Promise.all(cleanItUp)})}},mountCacheId:function mountCacheId(rule){if(typeof rule=="string"){return rule}var cacheConf=rule?rule.action.cache:false;if(cacheConf){return(cacheConf.name||DEFAULT_CACHE_NAME)+"::"+(cacheConf.version||DEFAULT_CACHE_VERSION)}return DEFAULT_CACHE_NAME+"::"+DEFAULT_CACHE_VERSION},register:function register(rule){cacheManager.registeredCaches.push(cacheManager.mountCacheId(rule))},addAll:function addAll(bundle){return new Promise(function(resolve,reject){if(Array.isArray(bundle)){bundle={files:bundle}}var promises=[];bundle.files.map(function(file){promises.push(cacheManager.add(file,null,null,{action:{fetch:file,cache:{name:bundle.name,version:bundle.version||1,expires:bundle.expires||false}}}))});Promise.all(promises).then(resolve).catch(reject)})},put:function put(rule,request,response){return cacheManager.add(request,typeof rule=="string"?rule:cacheManager.mountCacheId(rule),response,rule)},add:function add(request,cacheId,response,rule){cacheId=cacheId||cacheManager.mountCacheId(rule);return new Promise(function(resolve,reject){function addIt(response){if(response.status==200||response.type=="opaque"){caches.open(cacheId).then(function(cache){var opts=response.type=="opaque"?{mode:"no-cors"}:{};if((request.url||request).indexOf("http")!==0){request=_utils2.default.fixURL(request.url||request)}request=_utils2.default.createRequest(request,opts);if(request.method!="POST"){(function(){var cacheData={};if(rule&&rule.action&&rule.action.cache){cacheData=rule.action.cache}else{cacheData={name:cacheId,version:cacheId.split("::")[1]}}var clonedResponse=void 0;if(response.bodyUsed){cache.add(request).then(function(cached){DSWManager.traceStep(request,"Added to cache",{cacheData:cacheData})}).catch(function(err){_logger2.default.error("Could not save into cache",err)})}else{clonedResponse=response.clone();DSWManager.traceStep(request,"Added to cache",{cacheData:cacheData});clonedResponse&request&cache.put(request,clonedResponse)}})()}resolve(response);if(rule&&rule.action&&rule.action.cache&&rule.action.cache.expires){cacheManager.setExpiringTime(request,rule||cacheId,rule.action.cache.expires)}}).catch(function(err){_logger2.default.error("Could not save into cache",err);resolve(response)})}else{reject(response)}}if(!response){fetch(goFetch(null,request)).then(addIt).catch(function(err){DSWManager.traceStep(request,"Fetch failed");_logger2.default.error("[ DSW ] :: Failed fetching "+(request.url||request),err);reject(response)})}else{addIt(response)}})},setExpiringTime:function setExpiringTime(request,rule){var expiresAt=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;if(typeof expiresAt=="string"){expiresAt=parseExpiration(rule,expiresAt)}_indexeddbManager2.default.addOrUpdate({url:request.url||request,dateAdded:(new Date).getTime(),expiresAt:expiresAt},CACHE_CREATED_DBNAME)},hasExpired:function hasExpired(request){return new Promise(function(resolve,reject){_indexeddbManager2.default.find(CACHE_CREATED_DBNAME,"url",request.url||request).then(function(r){if(r&&(new Date).getTime()>r.dateAdded+r.expiresAt){resolve(true)}else{resolve(false)}}).catch(function(_){resolve(false)})})},get:function get(rule,request,event,matching,forceFromCache){var treatFailure=arguments.length>5&&arguments[5]!==undefined?arguments[5]:true;var actionType=Object.keys(rule.action)[0],url=request.url||request,pathName=new URL(url).pathname;if(rule.action.cache!==false&&(pathName=="/"||pathName.match(/^\/index\.([a-z0-9]+)/i))){rule.action.cache=rule.action.cache||{}}var opts=rule.options||{};opts.headers=opts.headers||new Headers;actionType=actionType.toLowerCase();actionType=actionType=="idb"?"indexeddb":actionType;var verifyCache=void 0,urlToMatch=null;if(rule.action.cache&&rule.action.cache.expires){verifyCache=cacheManager.hasExpired(request)}else{verifyCache=Promise.resolve()}switch(actionType){case"bypass":{if(rule.action[actionType]=="request"){var treatResponse=function treatResponse(response){if(response.status>=200&&response.status<300){DSWManager.traceStep(event.request,"Request bypassed");return response}else{DSWManager.traceStep(event.request,"Bypassed request failed and was ignored");var resp=new Response("");return resp}};return fetch(goFetch(null,event.request)).then(treatResponse).catch(treatResponse)}else{DSWManager.traceStep(event.request,"Bypassed request");actionType="output";rule.action[actionType]=""}}case"output":{DSWManager.traceStep(event.request,"Responding with string output",{output:(rule.action[actionType]+"").substring(0,180)});return new Response(_utils2.default.applyMatch(matching,rule.action[actionType]))}case"indexeddb":{return new Promise(function(resolve,reject){function treatFetch(response){if(response&&response.status==200){var done=function done(err){if(err){DSWManager.traceStep(event.request,"Could not save response into IndexedDB",{err:err})}else{DSWManager.traceStep(event.request,"Response object saved into IndexedDB")}resolve(response)};_indexeddbManager2.default.save(rule.name,response.clone(),request,rule).then(done).catch(done)}else{url=request.url;pathName=new URL(url).pathname;DSWManager.traceStep(event.request,"Fetch failed",{url:request.url,status:response.status,statusText:response.statusText});return DSWManager.treatBadPage(response,pathName,event)}}_indexeddbManager2.default.get(rule.name,request).then(function(result){if(result){DSWManager.traceStep(event.request,"Found stored in IndexedDB");return treatFetch(result)}else{DSWManager.traceStep(event.request,"Will fetch",{url:request.url,method:request.method});return goFetch(rule,request,event,matching).then(treatFetch).catch(treatFetch)}})})}case"redirect":case"fetch":{request=DSWManager.createRedirect(rule.action.fetch||rule.action.redirect,event,matching);url=request.url;pathName=new URL(url).pathname}case"cache":{var cacheId=void 0;if(event.request.cachedFrom){urlToMatch=event.request.cachedFrom}else{urlToMatch=null}if(rule.action.cache){cacheId=cacheManager.mountCacheId(rule)}return verifyCache.then(function(expired){var lookForCache=void 0;if(expired&&!forceFromCache){DSWManager.traceStep(event.request,"Cache was expired");lookForCache=Promise.resolve()}else{lookForCache=caches.match(urlToMatch||request)}return lookForCache.then(function(result){if(result&&result.status!=200){DSWManager.traceStep(event.request,"Not found in cache",{url:request.url,status:result.status,statusText:result.statusText});if(expired){DSWManager.traceStep(event.request,"Forcing "+(expired?"expired ":"")+"from cache");return cacheManager.get(rule,request,event,matching,true)}if(treatFailure){(DSWManager.rules[result.status]||[]).some(function(cur,idx){if(pathName.match(cur.rx)){if(cur.action.fetch||cur.action.redirect){DSWManager.traceStep(event.request,"Found fallback for failure",{rule:cur,url:request.url});result=goFetch(rule,request,event,matching);return true}}})}return result}else{if(result){if(request.url==event.request.url){DSWManager.traceStep(event.request,"Result found in cache",{url:event.request.url,cacheSource:event.request.cachedFrom||event.request.url});return result}else{DSWManager.traceStep(event.request,"Redirecting",{from:event.request.url,to:request.url},false,{url:request.url,id:request.requestId,steps:request.traceSteps,rule:rule});return Response.redirect(request.url,302)}}else if(actionType=="redirect"){DSWManager.traceStep(event.request,"Must redirect",{from:event.request.url,to:request.url},false,{url:request.url,id:request.requestId,steps:request.traceSteps,rule:rule});return Response.redirect(request.url,302)}else{var treatFetch=function treatFetch(response){if(response.type=="opaque"){if(rule.action.cache!==false){DSWManager.traceStep(event.request,"Added to cache (opaque)",{url:request.url});return cacheManager.add(_utils2.default.createRequest(request,{mode:request.mode||"no-cors"}),cacheManager.mountCacheId(rule),response,rule)}return response}if(!response.status){response.status=404}if(response.status==200){DSWManager.traceStep(event.request,"Received result OK (200)",{url:request.url});if(rule.action.cache!==false){DSWManager.traceStep(event.request,"Saving into cache",{url:request.url});return cacheManager.add(request,cacheManager.mountCacheId(rule),response,rule)}else{return response}}else{DSWManager.traceStep(request,"Failed fetching",{url:request.url});if(expired){_logger2.default.warn("Cache for ",request.url||request,"had expired, but the updated version could not be retrieved from the network!\n","Delivering the outdated cached data");DSWManager.traceStep(event.request,"Using expired cache",{note:"Failed fetching, loading from cache even though it was expired"});return cacheManager.get(rule,request,event,matching,true)}return DSWManager.treatBadPage(response,pathName,event)}};if(treatFailure){DSWManager.traceStep(event.request,"Will fetch",{url:request.url,method:request.method});return goFetch(rule,request,event,matching).then(treatFetch).catch(treatFetch)}}}})})}default:{return event}}}};exports.default=cacheManager},{"./indexeddb-manager.js":4,"./logger.js":5,"./utils.js":8}],3:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _utils=require("./utils.js");var _utils2=_interopRequireDefault(_utils);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var origin=location.origin;function createNewRequest(tmpUrl,request,event){var sameOrigin=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var mode=request.mode;if(!mode||mode=="navigate"){mode=sameOrigin?"cors":"no-cors"}var req=new Request(tmpUrl,{method:request.method||"GET",headers:request.headers||{},mode:mode,cache:"default",redirect:"manual"});if(request.body){req.body=request.body}req.requestId=(event?event.request:request).requestId;req.traceSteps=(event?event.request:request).traceSteps;return req}function goFetch(rule,request,event,matching){var tmpUrl=rule?rule.action.fetch||rule.action.redirect:"";if(typeof request=="string"){request=_utils2.default.fixURL(request);request=location.origin+request}if(!tmpUrl){tmpUrl=request.url||request}else{tmpUrl=_utils2.default.fixURL(tmpUrl);tmpUrl=location.origin+tmpUrl}var originalUrl=tmpUrl;var sameOrigin=void 0;try{sameOrigin=new URL(tmpUrl).origin==origin}catch(err){throw new Error('The URL "'+tmpUrl+'" is not valid and could not be parsed.')}tmpUrl=_utils2.default.applyMatch(matching,tmpUrl);if(request&&!rule){return createNewRequest(tmpUrl,request,event,sameOrigin)}var actionType=Object.keys(rule.action)[0];var opts=rule.options||{};opts.headers=opts.headers||new Headers;if(rule.action.cache===false){opts.headers.append("pragma","no-cache");opts.headers.append("cache-control","no-store,no-cache");tmpUrl=tmpUrl+(tmpUrl.indexOf("?")>0?"&":"?")+(new Date).getTime()}var reqConfig={method:opts.method||request.method,headers:opts||request.headers,mode:actionType=="redirect"?request.mode||"same-origin":"cors",redirect:actionType=="redirect"?"manual":request.redirect};if(!sameOrigin){reqConfig.mode=request.mode||"no-cors"}request=new Request(tmpUrl||request.url,reqConfig);request.requestId=(event?event.request:request).requestId;request.traceSteps=(event?event.request:request).traceSteps;if(actionType=="redirect"){return Response.redirect(request.url,302)}else{return fetch(request,opts)}}exports.default=goFetch},{"./utils.js":8}],4:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _logger=require("./logger.js");var _logger2=_interopRequireDefault(_logger);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var DEFAULT_DB_NAME="defaultDSWDB";var INDEXEDDB_REQ_IDS="indexeddb-id-request";var dbs={};var cacheManager;function getObjectStore(dbName){var mode=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"readwrite";var db=dbs[dbName],tx=void 0;if(db){tx=db.transaction(dbName,mode);return tx.objectStore(dbName)}return false}var indexedDBManager={setup:function setup(cm){cacheManager=cm},clear:function clear(){var dbList=[];var _loop=function _loop(db){dbList.push(new Promise(function(resolve,reject){var req=indexedDB.deleteDatabase(db);req.onsuccess=function(){resolve()};req.onerror=function(err){reject();_logger2.default.error("Could not drop indexedDB database\n",err||this.error)};req.onblocked=function(err){reject();_logger2.default.error("Could not drop indexedDB database, it was locked\n",err||this.error)}}))};for(var db in dbs){_loop(db)}return Promise.all([].concat(dbList))},create:function create(config){return new Promise(function(resolve,reject){var request=indexedDB.open(config.name||DEFAULT_DB_NAME,parseInt(config.version,10)||undefined);function dataBaseReady(db,dbName,resolve){db.onversionchange=function(event){db.close()};if(!dbs[dbName]){dbs[dbName]=db}resolve(config)}request.onerror=function(event){reject("Could not open the database (indexedDB) for "+config.name)};request.onupgradeneeded=function(event){var db=event.target.result;var baseData={};if(config.key){baseData.keyPath=config.key}if(!config.key||config.autoIncrement){baseData.autoIncrement=true}if(config.version){baseData.version=config.version}else{baseData.version=1}if(event.oldVersion&&event.oldVersion<baseData.version){db.deleteObjectStore(config.name)}else if(event.oldVersion===0){(function(){var objectStore=db.createObjectStore(config.name,baseData);if(config.indexes){config.indexes.forEach(function(index){if(typeof index=="string"){objectStore.createIndex(index,index,{})}else{objectStore.createIndex(index.name,index.path||index.name,index.options)}})}objectStore.createIndex(config.key,config.key,{unique:true})})()}dataBaseReady(db,config.name,resolve)};request.onsuccess=function(event){var db=event.target.result;dataBaseReady(db,config.name,resolve)}})},get:function get(dbName,request){return new Promise(function(resolve,reject){caches.match(request).then(function(result){if(result){result.json().then(function(obj){var store=getObjectStore(dbName),index=store?store.index(obj.key):false,getter=index?index.get(obj.value):false;if(getter){getter.onsuccess=function(event){resolve(new Response(JSON.stringify(event.target.result),{headers:{"Content-Type":"application/json"}}))};getter.onerror=function(event){resolve()}}else{resolve()}})}else{resolve()}})})},find:function find(dbName,key,value){return new Promise(function(resolve,reject){var store=getObjectStore(dbName);if(store){var index=store.index(key),getter=index.get(value);getter.onsuccess=function(event){resolve(event.target.result)};getter.onerror=function(event){reject()}}else{resolve()}})},addOrUpdate:function addOrUpdate(obj,dbName){return new Promise(function(resolve,reject){var store=getObjectStore(dbName);if(store){var req=store.put(obj);req.onsuccess=function addOrUpdateSuccess(){resolve(obj)};req.onerror=function addOrUpdateError(err){resolve(obj)}}else{resolve({})}})},save:function save(dbName,data,request,rule){var _this=this;return new Promise(function(resolve,reject){data.json().then(function(obj){var store=getObjectStore(dbName),req=void 0;if(store){req=store.put(obj);req.onsuccess=function(){var tmp={};var key=rule.action.indexedDB.key||"id";tmp.key=key;tmp.value=obj[key];cacheManager.put(INDEXEDDB_REQ_IDS,request,new Response(JSON.stringify(tmp),{headers:{"Content-Type":"application/json"}}));resolve()};req.onerror=function(event){reject("Failed saving to the indexedDB!\n"+this.error)}}else{reject("Failed saving into indexedDB...\n"+_this.error)}}).catch(function(err){_logger2.default.error("Failed saving into indexedDB!\n",err.message||_this.error,err);reject("Failed saving into indexedDB:\n"+_this.error)})})}};exports.default=indexedDBManager},{"./logger.js":5}],5:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var TYPES={log:"[  LG  ] :: ",info:"[ INFO ] :: ",warn:"[ WARN ] :: ",error:"[ FAIL ] :: ",track:"[ STEP ] :: "};var logger={info:function info(){var args=[].slice.call(arguments);args.unshift("color: blue");args.unshift("%c "+TYPES.info);console.info.apply(console,args)},log:function log(){var args=[].slice.call(arguments);args.unshift("color: gray");args.unshift("%c "+TYPES.log);console.log.apply(console,args)},warn:function warn(){var args=[].slice.call(arguments);args.unshift("font-weight: bold; color: yellow; text-shadow: 0 0 1px black;");args.unshift("%c "+TYPES.warn);console.warn.apply(console,args)},error:function error(){var args=[].slice.call(arguments);args.unshift("font-weight: bold; color: red");args.unshift("%c "+TYPES.error);console.error.apply(console,args)},track:function track(){var args=[].slice.call(arguments);args.unshift("font-weight: bold");args.unshift("%c "+TYPES.track);console.debug.apply(console,args)}};exports.default=logger},{}],6:[function(require,module,exports){(function(global){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _logger=require("./logger.js");var _logger2=_interopRequireDefault(_logger);var _bestMatchingRx=require("./best-matching-rx.js");var _bestMatchingRx2=_interopRequireDefault(_bestMatchingRx);var _cacheManager=require("./cache-manager.js");var _cacheManager2=_interopRequireDefault(_cacheManager);var _goFetch=require("./go-fetch.js");var _goFetch2=_interopRequireDefault(_goFetch);var _strategies=require("./strategies.js");var _strategies2=_interopRequireDefault(_strategies);var _utils=require("./utils.js");var _utils2=_interopRequireDefault(_utils);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var isInSWScope=false;var isInTest=typeof global.it==="function";var preCache;var failedAppShellFiles=[];var ROOT_SW_SCOPE=null;var DSW={version:"1.12.2",build:"1507652166061",ready:null};var REQUEST_TIME_LIMIT=5e3;var REGISTRATION_TIMEOUT=12e3;var DEFAULT_NOTIF_DURATION=6e3;var currentlyMocking={};var installationFailure=function installationFailure(err){var errMessage="Failed storing appshell.\n "+failedAppShellFiles.join(",")+" failed loading.\n";return errMessage};function getSWRoot(){if(ROOT_SW_SCOPE){return ROOT_SW_SCOPE}ROOT_SW_SCOPE=new URL(location.href).pathname.replace(/\/[^\/]+$/,"/");return ROOT_SW_SCOPE}DSW.isOffline=DSW.offline=function(_){return!navigator.onLine};DSW.isOnline=DSW.online=function(_){return navigator.onLine};try{var SWScope=ServiceWorkerGlobalScope;if(self instanceof ServiceWorkerGlobalScope){isInSWScope=true}}catch(e){}if(isInSWScope){(function(){var DSWManager={requestId:0,tracking:{},trackMoved:{},rules:{},addRule:function addRule(sts,rule,rx){this.rules[sts]=this.rules[sts]||[];var newRule={name:rule.name,rx:rx,strategy:rule.strategy||"offline-first",action:rule["apply"]};this.rules[sts].push(newRule);if(newRule.action.cache){_cacheManager2.default.register(newRule)}else{if(newRule.action.cache===false){newRule.strategy="online-first"}}return newRule},treatBadPage:function treatBadPage(response,pathName,event){var result=void 0;DSWManager.traceStep(event.request,"Request failed",{status:response.status,statusText:response.statusText,url:response.url,type:response.type});(DSWManager.rules[response&&response.status?response.status:404]||[]).some(function(cur,idx){var matching=pathName.match(cur.rx);if(matching){if(cur.action.redirect&&!cur.action.fetch){cur.action.fetch=cur.action.redirect}if(cur.action.fetch){DSWManager.traceStep(event.request,"Found fallback rule",cur,false,{url:event.request.url,id:event.request.requestId,steps:event.request.traceSteps});var req=new Request(cur.action.fetch);req.requestId=event.request.requestId;req.traceSteps=event.request.traceSteps;result=_cacheManager2.default.get(cur,req,event,matching);return true}}});if(!result){DSWManager.traceStep(event.request,"No fallback found. Request failed")}return result||response},setup:function setup(){var _this=this;var dswConfig=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};DSWManager.rootSWScope=getSWRoot();_utils2.default.setup(DSWManager,PWASettings,DSW);_cacheManager2.default.setup(DSWManager,PWASettings,_goFetch2.default);_strategies2.default.setup(DSWManager,_cacheManager2.default,_goFetch2.default);return DSW.ready=new Promise(function(resolve,reject){preCache=PWASettings.appShell||[];var dbs=[];Object.keys(dswConfig.rules||dswConfig.dswRules).forEach(function(heuristic){var ruleName=heuristic;heuristic=(dswConfig.rules||dswConfig.dswRules)[heuristic];heuristic.name=ruleName;heuristic.action=heuristic.action||heuristic["apply"];var appl=heuristic.action,extensions=void 0,status=void 0,path=void 0;if(!heuristic.match.length&&!Object.keys(heuristic.match).length){return}if(!Object.keys(heuristic.match).length){return}if(Array.isArray(heuristic.match)){extensions=[];path=[];heuristic.match.map(function(cur){if(cur.extension){extensions.push(cur.extension)}if(cur.path){path.push(cur.path)}});extensions=extensions.join("|");if(extensions.length){extensions+="|"}path=(path.join("|")||"")+"|"}else{path=heuristic.match.path||"";extensions=heuristic.match.extension,status=heuristic.match.status}var ending="([/&?]|$)";if(Array.isArray(extensions)){extensions="([.+]?)("+extensions.join(ending+"|")+ending+")"}else if(typeof extensions=="string"){extensions="([.+]?)("+extensions+ending+")"}else{extensions=""}var rx=new RegExp(path+(extensions?"((\\.)(("+extensions+")([\\?&/].+)?))":""),"i");var noVars=/\$[0-9]+/;if(appl.fetch&&!appl.fetch.match(noVars)||appl.redirect&&!appl.redirect.match(noVars)||appl.cache&&appl.cache.from){preCache.push({url:appl.cache&&appl.cache.from?appl.cache.from:appl.fetch||appl.redirect,rule:heuristic})}appl.indexedDB=appl.indexedDB||appl.idb||appl.IDB||undefined;if(appl.indexedDB){dbs.push(appl.indexedDB)}status=Array.isArray(status)?status:[status||"*"];status.forEach(function(sts){if(sts==200){sts="*"}var addedRule=_this.addRule(sts,heuristic,rx)})});_this.addRule("*",{name:"serviceWorker",strategy:"fastest",match:{path:/^\/dsw.js(\?=dsw-manager)?$/},apply:{cache:{}}},location.href);var rootMatchingRX=/^(\/|\/index(\.[0-1a-z]+)?)$/;_this.addRule("*",{name:"rootDir",strategy:"fastest",match:{path:getSWRoot()},apply:{cache:{}}},rootMatchingRX);preCache.unshift(getSWRoot());if(preCache.length||dbs.length){return Promise.all(preCache.map(function(cur){var url=cur.url||cur;return _cacheManager2.default.add(url,null,null,cur.rule).catch(function(err){if(err&&err.status==404){failedAppShellFiles.push(err.url);throw new Error(installationFailure())}})}).concat(dbs.map(function(cur){return _cacheManager2.default.createDB(cur).catch(function(err){throw new Error("Failed preparing IndexedDB\n",err.message||err)})}))).then(function(_){resolve()}).catch(function(err){var errMessage="Could not register the service worker."+"\n"+(err.url||err.message)+"\n";_logger2.default.error(errMessage,err);reject(errMessage)})}else{resolve()}})},getRulesBeforeFetching:function getRulesBeforeFetching(){return this.rules["*"]||false},createRequest:function createRequest(request,event,matching){return(0,_goFetch2.default)(null,request,event,matching)},createRedirect:function createRedirect(request,event,matching){return(0,_goFetch2.default)(null,request,event,matching)},traceStep:function traceStep(request,step,data){var fill=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var moved=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;if(Array.isArray(request)){request.forEach(function(req){DSWManager.traceStep(req,step,data,fill,moved)});return}if(DSWManager.tracking){var id=request.requestId;request.traceSteps=request.traceSteps||[];data=data||{};if(fill){data.url=request.url;data.type=request.type;data.method=request.method;data.redirect=request.redirect;data.referrer=request.referrer}var reqTime=(performance.now()-request.timeArriving)/1e3;request.traceSteps.push({step:step,data:data,timing:reqTime.toFixed(4)+"s"})}if(moved){DSWManager.trackMoved[moved.url]=moved}},respondItWith:function respondItWith(event,response){event.respondWith(new Promise(function(resolve,reject){if(typeof response.then=="function"){response.then(function(result){if(typeof result.clone!="function"){return resolve(result)}var response=result.clone();if(DSWManager.tracking&&response.status!=302){response.text().then(function(result){if((result[0]||"").charCodeAt(0)<128){result=result.substring(0,180)+(result.length>180?"...":"")}DSWManager.traceStep(event.request,"Responded",{response:{status:response.status,statusText:response.statusText,type:response.type,method:response.method,url:response.url},preview:result},true);DSWManager.sendTraceData(event)})}resolve(result)})}else{resolve(response)}}))},sendTraceData:function sendTraceData(event){var tracker=void 0;var traceBack=function traceBack(port,key){var traceData={id:event.request.requestId,src:event.request.traceSteps[0].data.url,method:event.request.traceSteps[0].data.method,steps:event.request.traceSteps};if(traceData.src!=event.request.url){traceData.redirectedTo=event.request.url}port.postMessage(traceData)};for(tracker in DSWManager.tracking){if(event.request.url.match(tracker)){DSWManager.tracking[tracker].ports.forEach(traceBack);break}}if(event.request.traceSteps&&event.request.traceSteps.length){delete DSWManager.trackMoved[event.request.traceSteps[0].data.url]}},broadcast:function broadcast(message){return clients.matchAll().then(function(result){result.forEach(function(cur){cur.postMessage(message)})})},startListening:function startListening(){self.addEventListener("fetch",function(event){DSWManager.requestId=1+(DSWManager.requestId||0);if(DSWManager.trackMoved[event.request.url]){var movedInfo=DSWManager.trackMoved[event.request.url];event.request.requestId=movedInfo.id;event.request.traceSteps=movedInfo.steps;event.request.originalSrc=movedInfo.url;if(movedInfo.rule&&movedInfo.rule.action&&movedInfo.rule.action.cache&&movedInfo.rule.action.cache.from){event.request.cachedFrom=movedInfo.rule.action.cache.from}delete DSWManager.trackMoved[event.request.url]}else{event.request.requestId=DSWManager.requestId;event.request.timeArriving=performance.now();DSWManager.traceStep(event.request,"Arrived in Service Worker",{},true)}var url=new URL(event.request.url);var sameOrigin=url.origin==location.origin;var pathName=url.pathname;if(event.request.method!="GET"){DSWManager.traceStep(event.request,"Ignoring "+event.request.method+" request",{});DSWManager.sendTraceData(event);return}if(!Object.keys(DSWManager.rules).length){return DSWManager.setup(PWASettings).then(function(_){return fetch(event)})}if(PWASettings.enforceSSL){if(url.protocol!="https:"&&url.hostname!="localhost"){DSWManager.traceStep(event.request,"Redirected from http to https");return DSWManager.respondItWith(event,Response.redirect(event.request.url.replace("http:","https:"),302))}}var matchingRule=void 0;if(!sameOrigin){matchingRule=(0,_bestMatchingRx2.default)(url.origin+url.pathname,DSWManager.rules["*"])}else{matchingRule=(0,_bestMatchingRx2.default)(pathName,DSWManager.rules["*"])}if(matchingRule){DSWManager.traceStep(event.request,'Best matching rule found: "'+matchingRule.rule.name+'"',{rule:matchingRule.rule,url:event.request.url});return DSWManager.respondItWith(event,_strategies2.default[matchingRule.rule.strategy](matchingRule.rule,event.request,event,matchingRule.matching))}else{if(!sameOrigin){DSWManager.traceStep(event.request,"Ignoring request because it is not from same origin and there are no rules for it",{});DSWManager.sendTraceData(event);return}}var defaultTreatment=function defaultTreatment(response){if(response&&(response.status==200||response.type=="opaque"||response.type=="opaqueredirect")){return response}else{return DSWManager.treatBadPage(response,pathName,event)}};return DSWManager.respondItWith(event,fetch((0,_goFetch2.default)(null,event.request)).then(defaultTreatment).catch(defaultTreatment))})}};var DSWStatus=false;var DSWStatusError=null;self.addEventListener("activate",function(event){event.waitUntil(function(_){var promises=[];if(PWASettings.applyImmediately){promises.push(self.clients.claim())}promises.push(_cacheManager2.default.deleteUnusedCaches(PWASettings.keepUnusedCaches));return Promise.all(promises).then(function(_){DSWManager.broadcast({DSWStatus:DSWStatus,error:DSWStatusError||null})}).catch(function(err){DSWManager.broadcast({DSWStatus:DSWStatus,error:err||DSWStatusError})})}())});self.addEventListener("install",function(event){PWASettings.dswRules=PWASettings.rules||PWASettings.dswRules||{};PWASettings.dswVersion=PWASettings.version||PWASettings.dswVersion||"1";if(PWASettings.applyImmediately){return event.waitUntil(DSWManager.setup(PWASettings).then(function(_){DSWStatus=true;self.skipWaiting()}).catch(function(err){DSWStatus=false;DSWStatusError=err;self.skipWaiting()}))}else{return event.waitUntil(DSWManager.setup(PWASettings))}});self.addEventListener("message",function(event){var ports=event.ports;if(event.data.trackPath){var tp=event.data.trackPath;DSWManager.tracking[tp]={rx:new RegExp(tp,"i"),ports:ports};return}if(event.data.clearEverythingUp){_cacheManager2.default.clear().then(function(result){ports.forEach(function(port){port.postMessage({cacheCleaned:true})})});return}if(event.data.enableMocking){var mockId=event.data.enableMocking.mockId;var matching=event.data.enableMocking.match;var finalMockId=mockId+matching;currentlyMocking[event.source.id]=currentlyMocking[event.source.id]||{};var client=currentlyMocking[event.source.id];client[finalMockId]=client[finalMockId]||[];currentlyMocking[finalMockId].push();return}});self.addEventListener("push",function(event){DSWManager.broadcast({event:"pushnotification",data:event.data});if(PWASettings.notification&&PWASettings.notification.dataSrc){return event.waitUntil(fetch(PWASettings.notification.dataSrc).then(function(response){if(response.status==200){return response.json().then(function(data){var notifData={};if(PWASettings.notification.dataPath){notifData=data[PWASettings.notification.dataPath]}else{notifData=data}var notif=self.registration.showNotification(notifData.title,{body:notifData.body||notifData.content||notifData.message,icon:notifData.icon||notifData.image,tag:notifData.tag||null})})}else{throw new Error("Fetching "+PWASettings.notification.dataSrc+" returned a "+response.status+" status.")}}).catch(function(err){_logger2.default.warn("Received a push, but Failed retrieving the notification data.",err)}))}else if(PWASettings.notification.title){var n=PWASettings.notification;var notif=self.registration.showNotification(n.title,{body:n.body||n.content||n.message,icon:n.icon||n.image,tag:n.tag||null})}});self.addEventListener("notificationclick",function(event){var tag=event.notification.tag,targetUrl=void 0,eventData={tag:tag,title:event.notification.title,body:event.notification.body,icon:event.notification.icon,badge:event.notification.badge,lang:event.notification.lang,timestamp:event.notification.timestamp};event.notification.close();if(PWASettings.notification&&PWASettings.notification.target!==void 0){targetUrl=PWASettings.notification.target}else{targetUrl=location.toString()}event.waitUntil(clients.matchAll({type:"window"}).then(function(windowClients){var p=void 0;for(var i=0;i<windowClients.length;i++){var client=windowClients[i];if((client.url==targetUrl||new URL(client.url).pathname==targetUrl)&&"focus"in client){p=client.focus();break}}if(!p&&targetUrl&&clients.openWindow){p=clients.openWindow(targetUrl)}else{p=Promise.resolve()}p.then(function(_){DSWManager.broadcast({event:"notificationclicked",data:eventData})})}))});self.addEventListener("sync",function(event){});DSWManager.startListening()})()}else{(function(){DSW.status={version:PWASettings.version||PWASettings.dswVersion,registered:false,sync:false,appShell:false,notification:false};var pendingResolve=void 0,pendingReject=void 0,registeredServiceWorker=void 0,installationTimeOut=void 0;var eventManager=function(){var events={};return{addEventListener:function addEventListener(eventName,listener){events[eventName]=events[eventName]||[];events[eventName].push(listener)},trigger:function trigger(eventName){var data=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var listener=void 0;try{if(events[eventName]){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=events[eventName][Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){listener=_step.value;if(typeof listener=="function"){listener(data)}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}listener="on"+eventName;if(typeof DSW[listener]=="function"){DSW[listener](data)}}catch(e){if(listener&&listener.name){listener=listener.name}else{listener=listener||"annonymous"}_logger2.default.error("Failed trigerring event "+eventName+" on listener "+listener,e.message,e)}}}}();DSW.addEventListener=eventManager.addEventListener;DSW.onpushnotification=function(){};DSW.onnotificationclicked=function(){};DSW.onenabled=function(){};DSW.onregistered=function(){};DSW.onunregistered=function(){};DSW.onnotificationsenabled=function(){};navigator.serviceWorker.addEventListener("message",function(event){if(pendingResolve&&event.data.DSWStatus!==void 0){if(registeredServiceWorker){if(event.data.DSWStatus){DSW.status.appShell=true;eventManager.trigger("activated",DSW.status);pendingResolve(DSW.status)}else{DSW.status.appShell=false;DSW.status.error=event.data.error;pendingReject(DSW.status);registeredServiceWorker.unregister()}}pendingResolve=false;pendingReject=false}eventManager.trigger(event.data.event,event.data.data)});DSW.trace=function(match,options,callback){if(!callback&&typeof options=="function"){callback=options;options={}}var messageChannel=new MessageChannel;messageChannel.port1.onmessage=function(event){callback(event.data)};navigator.serviceWorker.controller.postMessage({trackPath:match},[messageChannel.port2])};DSW.enableMocking=function(mockId){var match=arguments.length>1&&arguments[1]!==undefined?arguments[1]:".*";var messageChannel=new MessageChannel;navigator.serviceWorker.controller.postMessage({enableMocking:{mockId:mockId,match:match}},[messageChannel.port2])};DSW.disableMocking=function(mockId){var match=arguments.length>1&&arguments[1]!==undefined?arguments[1]:".*";var messageChannel=new MessageChannel;navigator.serviceWorker.controller.postMessage({disableMocking:{mockId:mockId,match:match}},[messageChannel.port2])};DSW.sendMessage=function(message){var waitForAnswer=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return new Promise(function(resolve,reject){var messageChannel=new MessageChannel;if(waitForAnswer){messageChannel.port1.onmessage=function(event){if(event.data.error){reject(event.data.error)}else{resolve(event.data)}}}else{setTimeout(resolve,10)}navigator.serviceWorker.controller.postMessage(message,[messageChannel.port2])})};DSW.onNetworkStatusChange=function(callback){var cb=function cb(){callback(navigator.onLine)};window.addEventListener("online",cb);window.addEventListener("offline",cb);if(!navigator.onLine){cb()}};DSW.isAppShellDone=DSW.isActivated=function(_){return DSW.status.registered&&DSW.status.appShell};DSW.isRegistered=function(_){return DSW.status.registered};DSW.enableNotifications=function(_){return new Promise(function(resolve,reject){if(navigator.onLine){navigator.serviceWorker.ready.then(function(reg){var req=reg.pushManager.subscribe({userVisibleOnly:true});return req.then(function(sub){DSW.status.notification=sub.endpoint;eventManager.trigger("notificationsenabled",DSW.status);_logger2.default.info("Registered to notification server");resolve(sub)}).catch(function(reason){reject(reason||"Not allowed by user")})})}else{reject("Must be connected to enable notifications")}})};DSW.notify=function(){var title=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"Untitled";var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return new Promise(function(resolve,reject){DSW.enableNotifications().then(function(_){var opts={body:options.body||"",icon:options.icon||false,tag:options.tag||null};var n=new Notification(title,opts);if(options.duration){setTimeout(function(_){n.close()},options.duration*1e3)}resolve(n)}).catch(function(reason){reject(reason)})})};DSW.unregister=function(_){return new Promise(function(resolve,reject){if(DSW.status){if(!DSW.status.registered){resolve(DSW.status)}}DSW.ready.then(function(result){_cacheManager2.default.clear().then(function(result){if(result){DSW.status.appShell=false;localStorage.setItem("DSW-STATUS",JSON.stringify(DSW.status));registeredServiceWorker.unregister().then(function(success){if(success){DSW.status.registered=false;DSW.status.sync=false;DSW.status.notification=false;DSW.status.ready=false;localStorage.setItem("DSW-STATUS",JSON.stringify(DSW.status));resolve(DSW.status);eventManager.trigger("unregistered",DSW.status)}else{reject("Could not unregister service worker")}})}else{reject("Could not clean up the caches")}})})})};DSW.setup=function(){var config=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(DSW.ready){return DSW.ready}return new Promise(function(resolve,reject){DSW.ready=new Promise(function(resolve,reject){var appShellPromise=new Promise(function(resolve,reject){pendingResolve=function pendingResolve(){clearTimeout(installationTimeOut);resolve(DSW.status)}});pendingReject=function pendingReject(reason){clearTimeout(installationTimeOut);reject(reason||"Installation timeout")};if(navigator.serviceWorker){if(!navigator.serviceWorker.controller){installationTimeOut=setTimeout(function(_){reject("Registration timed out")},config.timeout||REGISTRATION_TIMEOUT);var documentBodyPromise=new Promise(function(resolve){if(document.readyState==="complete"){resolve(document)}else{document.addEventListener("DOMContentLoaded",function(){resolve(document)})}});var src=document.querySelector('script[src$="dsw.js"]').getAttribute("src");Promise.all([documentBodyPromise,navigator.serviceWorker.register(src)]).then(function(SW){registeredServiceWorker=SW;DSW.status.registered=true;navigator.serviceWorker.ready.then(function(reg){DSW.status.ready=true;eventManager.trigger("registered",DSW.status);Promise.all([appShellPromise,new Promise(function(resolve,reject){if(PWASettings.notification&&PWASettings.notification.auto){return DSW.enableNotifications()}else{resolve()}}),new Promise(function(resolve,reject){if(config&&config.sync){if("SyncManager"in window){navigator.serviceWorker.ready.then(function(reg){return reg.sync.register("syncr")}).then(function(_){DSW.status.sync=true;resolve()})}else{DSW.status.sync="Failed enabling sync";resolve()}}else{resolve()}})]).then(function(_){localStorage.setItem("DSW-STATUS",JSON.stringify(DSW.status));eventManager.trigger("enabled",DSW.status);_logger2.default.info("Service Worker was registered",DSW.status);resolve(DSW.status)})})}).catch(function(err){reject({status:false,sync:false,sw:false,message:"Failed registering service worker with the message:\n "+err.message,error:err})})}else{if(config&&config.trace){navigator.serviceWorker.ready.then(function(reg){registeredServiceWorker=reg;var match=void 0;for(match in config.trace){DSW.trace(match,config.trace[match])}})}else{navigator.serviceWorker.ready.then(function(reg){registeredServiceWorker=reg})}DSW.status=JSON.parse(localStorage.getItem("DSW-STATUS"))||DSW.status;resolve(DSW.status)}}else{DSW.status.fail="Service worker not supported"}});if(!DSW.isActivated()){return DSW.ready.then(function(result){resolve(result)}).catch(function(reason){reject(reason)})}})};if(typeof window!=="undefined"){window.DSW=DSW}})()}exports.default=DSW}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./best-matching-rx.js":1,"./cache-manager.js":2,"./go-fetch.js":3,"./logger.js":5,"./strategies.js":7,"./utils.js":8}],7:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _utils=require("./utils.js");var _utils2=_interopRequireDefault(_utils);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var DSWManager=void 0;var cacheManager=void 0;var goFetch=void 0;function common(rule,request,event,matching){if(rule.action.bundle){DSWManager.traceStep(event.request,"Will load and cache bundle in background",{bundle:rule.action.bundle});cacheManager.addAll(rule.action.bundle).then(function(result){DSWManager.traceStep(event.request,"Bundle loaded and cached in background",{bundle:rule.action.bundle})}).catch(function(err){DSWManager.traceStep(event.request,"Could not load and cache bundle",{bundle:rule.action.bundle});console.warn("Could not load and cache all the bundle files",err.message||err)})}}var strategies={setup:function setup(dswM,cacheM,gf){DSWManager=dswM;cacheManager=cacheM;goFetch=gf},"offline-first":function offlineFirstStrategy(rule,request,event,matching){common(rule,request,event,matching);DSWManager.traceStep(event.request,"Info: Using offline first strategy",{url:request.url});return cacheManager.get(rule,request,event,matching)},"online-first":function onlineFirstStrategy(rule,request,event,matching){common(rule,request,event,matching);DSWManager.traceStep(event.request,"Info: Using online first strategy",{url:request.url});function treatIt(response){if(response.status==200){if(rule.action.cache){cacheManager.put(rule,request,response).then(function(_){DSWManager.traceStep(event.request,"Updated cache")})}return response}return cacheManager.get(rule,request,event,matching).then(function(result){var pathName=new URL(event.request.url).pathname;return result||DSWManager.treatBadPage(response,pathName,event)})}if(_utils2.default.DSW.isOffline()){return treatIt(new Response("",{status:404,statusText:"Browser is offline",headers:{"Content-Type":"text/plain"}}))}return goFetch(rule,request,event,matching).then(treatIt).catch(treatIt)},fastest:function fastestStrategy(rule,request,event,matching){common(rule,request,event,matching);DSWManager.traceStep(event.request,"Info: Using fastest strategy",{url:request.url});var pathName=new URL(event.request.url).pathname;var networkTreated=false,cacheTreated=false,networkFailed=false,cacheFailed=false;return new Promise(function(resolve,reject){function treatFetch(response){var result=void 0;if(response&&response.status==200){if(rule.action.cache){cacheManager.put(rule,request,response).then(function(_){DSWManager.traceStep(event.request,"Updated cache")})}}if(!cacheTreated){if(response.status==200){networkTreated=true;DSWManager.traceStep(event.request,"Fastest strategy resolved from network",{url:response.url||request.url});resolve(response)}else{DSWManager.traceStep(event.request,"Fastest strategy failed fetching",{status:response.status,statusText:response.statusText});networkFailed=true;treatCatch(response)}}}function treatCache(result){if(result&&!networkTreated){cacheTreated=true;DSWManager.traceStep(event.request,"Fastest strategy resolved from cached");resolve(result);return result}else{cacheFailed=true;if(!networkTreated){treatCatch()}}}function treatCatch(response){if(networkFailed&&cacheFailed){DSWManager.traceStep(event.request,"Fastest strategy could not fetch nor find in cache");resolve(DSWManager.treatBadPage(response,pathName,event))}}goFetch(rule,request.clone(),event,matching).then(treatFetch).catch(treatFetch);cacheManager.get(rule,request,event,matching,false,false).then(treatCache).catch(treatCatch)})}};exports.default=strategies},{"./utils.js":8}],8:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var utils={DSWManager:null,PWASettings:null,applyMatch:function applyMatch(matching,text){if(matching&&matching.length>1&&text){matching.forEach(function(cur,idx){text=text.replace(new RegExp("\\$"+idx,"i"),cur)})}return text},createRequest:function createRequest(request,reqData){var reqConfig={method:reqData.method||request.method||"GET",headers:reqData.headers||request.headers||new Headers,mode:reqData.mode||(reqData.redirect?"same-origin":"cors"),redirect:reqData.redirect||"manual",cache:"default"};var req=new Request(request.url||request,reqConfig);req.requestId=request.requestId;return req},fixURL:function fixURL(url){if(utils.DSWManager.rootSWScope!=url){return url.replace(/^([^http]|[^\/]|[^\.])/,utils.DSWManager.rootSWScope+"/$1").replace(/([^\:])\/\//g,"$1")}else{return url}},setup:function setup(DSWManager,PWASettings,DSW){utils.DSWManager=DSWManager;utils.PWASettings=PWASettings;utils.DSW=DSW}};exports.default=utils},{}]},{},[6]);